import{a as S,E as j,i as U,g as B}from"./index-T5KmWP1B.js";import{_ as M}from"./index-94vktnnO.js";import{h as F,k as z}from"./index-yH0Ry0aD.js";import{U as b}from"./event-vOXeFsAk.js";import{p as V}from"./index-1biW9QUL.js";import{a9 as H,C,s as _,d as L,n as $,x as R,P as D,M as G,r as w,a6 as p,q as J,a7 as A}from"./core-ST-i4T9p.js";import{e as Q}from"./strings-tW-KZ-C8.js";const W=(e,{attrs:c,emit:i},{tree:d,key:s})=>{const a=F("tree-select"),u={...V(H(e),Object.keys(S.props)),...c,"onUpdate:modelValue":r=>i(b,r),valueKey:s,popperClass:C(()=>{const r=[a.e("popper")];return e.popperClass&&r.push(e.popperClass),r.join(" ")}),filterMethod:(r="")=>{e.filterMethod&&e.filterMethod(r),_(()=>{var t;(t=d.value)==null||t.filter(r)})},onVisibleChange:r=>{var t;(t=c.onVisibleChange)==null||t.call(c,r),e.filterable&&r&&u.filterMethod()}};return u},X=L({extends:j,setup(e,c){const i=j.setup(e,c);delete i.selectOptionClick;const d=$().proxy;return _(()=>{i.select.states.cachedOptions.get(d.value)||i.select.onOptionCreate(d)}),i},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function T(e){return e||e===0}function P(e){return Array.isArray(e)&&e.length}function K(e){return Array.isArray(e)?e:T(e)?[e]:[]}function E(e,c,i,d,s){for(let a=0;a<e.length;a++){const u=e[a];if(c(u,a,e,s))return d?d(u,a,e,s):u;{const r=i(u);if(P(r)){const t=E(r,c,i,d,u);if(t)return t}}}}function q(e,c,i,d){for(let s=0;s<e.length;s++){const a=e[s];c(a,s,e,d);const u=i(a);P(u)&&q(u,c,i,a)}}const Y=(e,{attrs:c,slots:i,emit:d},{select:s,tree:a,key:u})=>{R(()=>e.modelValue,()=>{e.showCheckbox&&_(()=>{const l=a.value;l&&!U(l.getCheckedKeys(),K(e.modelValue))&&l.setCheckedKeys(K(e.modelValue))})},{immediate:!0,deep:!0});const r=C(()=>({value:u.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),t=(l,n)=>{var o;const f=r.value[l];return D(f)?f(n,(o=a.value)==null?void 0:o.getNode(t("value",n))):n[f]},N=K(e.modelValue).map(l=>E(e.data||[],n=>t("value",n)===l,n=>t("children",n),(n,o,f,y)=>y&&t("value",y))).filter(l=>T(l)),k=C(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const l=[];return q(e.data.concat(e.cacheData),n=>{const o=t("value",n);l.push({value:o,currentLabel:t("label",n),isDisabled:t("disabled",n)})},n=>t("children",n)),l}),m=C(()=>k.value.reduce((l,n)=>({...l,[n.value]:n}),{}));return{...V(H(e),Object.keys(M.props)),...c,nodeKey:u,expandOnClickNode:C(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:C(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(N):N),renderContent:(l,{node:n,data:o,store:f})=>l(X,{value:t("value",o),label:t("label",o),disabled:t("disabled",o)},e.renderContent?()=>e.renderContent(l,{node:n,data:o,store:f}):i.default?()=>i.default({node:n,data:o,store:f}):void 0),filterNodeMethod:(l,n,o)=>e.filterNodeMethod?e.filterNodeMethod(l,n,o):l?new RegExp(Q(l),"i").test(t("label",n)||""):!0,onNodeClick:(l,n,o)=>{var f,y,g;if((f=c.onNodeClick)==null||f.call(c,l,n,o),!(e.showCheckbox&&e.checkOnClickNode))if(!e.showCheckbox&&(e.checkStrictly||n.isLeaf)){if(!t("disabled",l)){const h=(y=s.value)==null?void 0:y.states.options.get(t("value",l));(g=s.value)==null||g.handleOptionSelect(h)}}else e.expandOnClickNode&&o.proxy.handleExpandIconClick()},onCheck:(l,n)=>{if(!e.showCheckbox)return;const o=t("value",l),f=n.checkedKeys,y=e.multiple?K(e.modelValue).filter(h=>h in m.value&&!a.value.getNode(h)&&!f.includes(h)):[],g=f.concat(y);if(e.checkStrictly)d(b,e.multiple?g:g.includes(o)?o:void 0);else if(e.multiple)d(b,a.value.getCheckedKeys(!0));else{const h=E([l],v=>!P(t("children",v))&&!t("disabled",v),v=>t("children",v)),x=h?t("value",h):void 0,I=T(e.modelValue)&&!!E([l],v=>t("value",v)===e.modelValue,v=>t("children",v));d(b,x===e.modelValue||I?void 0:x)}_(()=>{var h;const x=K(e.modelValue);a.value.setCheckedKeys(x),(h=c.onCheck)==null||h.call(c,l,{checkedKeys:a.value.getCheckedKeys(),checkedNodes:a.value.getCheckedNodes(),halfCheckedKeys:a.value.getHalfCheckedKeys(),halfCheckedNodes:a.value.getHalfCheckedNodes()})})},cacheOptions:k}};var Z=L({props:{data:{type:Array,default:()=>[]}},setup(e){const c=G(B);return R(()=>e.data,()=>{var i;e.data.forEach(s=>{c.states.cachedOptions.has(s.value)||c.states.cachedOptions.set(s.value,s)});const d=((i=c.selectRef)==null?void 0:i.querySelectorAll("input"))||[];Array.from(d).includes(document.activeElement)||c.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const ee=L({name:"ElTreeSelect",inheritAttrs:!1,props:{...S.props,...M.props,cacheData:{type:Array,default:()=>[]}},setup(e,c){const{slots:i,expose:d}=c,s=w(),a=w(),u=C(()=>e.nodeKey||e.valueKey||"value"),r=W(e,c,{select:s,tree:a,key:u}),{cacheOptions:t,...N}=Y(e,c,{select:s,tree:a,key:u}),k=p({});return d(k),J(()=>{Object.assign(k,{...V(a.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...V(s.value,["focus","blur"])})}),()=>A(S,p({...r,ref:m=>s.value=m}),{...i,default:()=>[A(Z,{data:t.value}),A(M,p({...N,ref:m=>a.value=m}))]})}});var O=z(ee,[["__file","tree-select.vue"]]);O.install=e=>{e.component(O.name,O)};const te=O,de=te;export{de as E};
