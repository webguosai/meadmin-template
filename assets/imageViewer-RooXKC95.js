import{d as V,m as K,r as y,aB as ve,y as pe,C as b,x as W,s as ge,q as _e,o as N,_ as q,k as o,w as p,B as t,V as d,W as G,ad as be,a as v,$ as E,K as J,c as L,ac as we,a1 as ke,X as he,au as Ie,T as xe,a2 as Ce,a3 as ye,ae as Q,j as ze}from"./core-ST-i4T9p.js";import{e as Ne,f as U,m as Ee,i as B,g as Oe,h as Te,j as Le,E as w,k as Ve,t as R,l as z,n as T,o as $e,w as Se}from"./index-yH0Ry0aD.js";import{h as Ae,j as Re,d as Be,k as Xe,f as Ye,z as Me,n as De,r as je,o as Fe}from"./elIcon-sXDKzXmT.js";import{E as ee}from"./index-sftZIlHI.js";import"./mock-iVyY1y2-.js";const Pe=Ne({urlList:{type:U(Array),default:()=>Ee([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:U(String),default:"anonymous"}}),He={close:()=>!0,switch:f=>B(f),rotate:f=>B(f)},Ze=["src","crossorigin"],Ke=V({name:"ElImageViewer"}),We=V({...Ke,props:Pe,emits:He,setup(f,{expose:k,emit:g}){const s=f,h={CONTAIN:{name:"contain",icon:K(Ae)},ORIGINAL:{name:"original",icon:K(Re)}},{t:X}=Oe(),l=Te("image-viewer"),{nextZIndex:te}=Le(),$=y(),Y=y([]),M=ve(),x=y(!0),ae=y(s.crossorigin),_=y(s.initialIndex),O=pe(h.CONTAIN),i=y({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ne=b(()=>{const{urlList:e}=s;return e.length<=1}),D=b(()=>_.value===0),j=b(()=>_.value===s.urlList.length-1),se=b(()=>s.urlList[_.value]),oe=b(()=>[l.e("btn"),l.e("prev"),l.is("disabled",!s.infinite&&D.value)]),le=b(()=>[l.e("btn"),l.e("next"),l.is("disabled",!s.infinite&&j.value)]),ie=b(()=>{const{scale:e,deg:a,offsetX:n,offsetY:c,enableTransition:m}=i.value;let r=n/e,u=c/e;switch(a%360){case 90:case-270:[r,u]=[u,-r];break;case 180:case-180:[r,u]=[-r,-u];break;case 270:case-90:[r,u]=[-u,r];break}const C={transform:`scale(${e}) rotate(${a}deg) translate(${r}px, ${u}px)`,transition:m?"transform .3s":""};return O.value.name===h.CONTAIN.name&&(C.maxWidth=C.maxHeight="100%"),C}),re=b(()=>B(s.zIndex)?s.zIndex:te());function S(){ue(),g("close")}function ce(){const e=R(n=>{switch(n.code){case z.esc:s.closeOnPressEscape&&S();break;case z.space:P();break;case z.left:H();break;case z.up:I("zoomIn");break;case z.right:Z();break;case z.down:I("zoomOut");break}}),a=R(n=>{const c=n.deltaY||n.deltaX;I(c<0?"zoomIn":"zoomOut",{zoomRate:s.zoomRate,enableTransition:!1})});M.run(()=>{T(document,"keydown",e),T(document,"wheel",a)})}function ue(){M.stop()}function de(){x.value=!1}function fe(e){x.value=!1,e.target.alt=X("el.image.error")}function me(e){if(x.value||e.button!==0||!$.value)return;i.value.enableTransition=!1;const{offsetX:a,offsetY:n}=i.value,c=e.pageX,m=e.pageY,r=R(C=>{i.value={...i.value,offsetX:a+C.pageX-c,offsetY:n+C.pageY-m}}),u=T(document,"mousemove",r);T(document,"mouseup",()=>{u()}),e.preventDefault()}function F(){i.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function P(){if(x.value)return;const e=$e(h),a=Object.values(h),n=O.value.name,m=(a.findIndex(r=>r.name===n)+1)%e.length;O.value=h[e[m]],F()}function A(e){const a=s.urlList.length;_.value=(e+a)%a}function H(){D.value&&!s.infinite||A(_.value-1)}function Z(){j.value&&!s.infinite||A(_.value+1)}function I(e,a={}){if(x.value)return;const{minScale:n,maxScale:c}=s,{zoomRate:m,rotateDeg:r,enableTransition:u}={zoomRate:s.zoomRate,rotateDeg:90,enableTransition:!0,...a};switch(e){case"zoomOut":i.value.scale>n&&(i.value.scale=Number.parseFloat((i.value.scale/m).toFixed(3)));break;case"zoomIn":i.value.scale<c&&(i.value.scale=Number.parseFloat((i.value.scale*m).toFixed(3)));break;case"clockwise":i.value.deg+=r,g("rotate",i.value.deg);break;case"anticlockwise":i.value.deg-=r,g("rotate",i.value.deg);break}i.value.enableTransition=u}return W(se,()=>{ge(()=>{const e=Y.value[0];e!=null&&e.complete||(x.value=!0)})}),W(_,e=>{F(),g("switch",e)}),_e(()=>{var e,a;ce(),(a=(e=$.value)==null?void 0:e.focus)==null||a.call(e)}),k({setActiveItem:A}),(e,a)=>(N(),q(ye,{to:"body",disabled:!e.teleported},[o(Ce,{name:"viewer-fade",appear:""},{default:p(()=>[v("div",{ref_key:"wrapper",ref:$,tabindex:-1,class:d(t(l).e("wrapper")),style:G({zIndex:t(re)})},[v("div",{class:d(t(l).e("mask")),onClick:a[0]||(a[0]=be(n=>e.hideOnClickModal&&S(),["self"]))},null,2),E(" CLOSE "),v("span",{class:d([t(l).e("btn"),t(l).e("close")]),onClick:S},[o(t(w),null,{default:p(()=>[o(t(Be))]),_:1})],2),E(" ARROW "),t(ne)?E("v-if",!0):(N(),L(J,{key:0},[v("span",{class:d(t(oe)),onClick:H},[o(t(w),null,{default:p(()=>[o(t(Xe))]),_:1})],2),v("span",{class:d(t(le)),onClick:Z},[o(t(w),null,{default:p(()=>[o(t(Ye))]),_:1})],2)],64)),E(" ACTIONS "),v("div",{class:d([t(l).e("btn"),t(l).e("actions")])},[v("div",{class:d(t(l).e("actions__inner"))},[o(t(w),{onClick:a[1]||(a[1]=n=>I("zoomOut"))},{default:p(()=>[o(t(Me))]),_:1}),o(t(w),{onClick:a[2]||(a[2]=n=>I("zoomIn"))},{default:p(()=>[o(t(De))]),_:1}),v("i",{class:d(t(l).e("actions__divider"))},null,2),o(t(w),{onClick:P},{default:p(()=>[(N(),q(we(t(O).icon)))]),_:1}),v("i",{class:d(t(l).e("actions__divider"))},null,2),o(t(w),{onClick:a[3]||(a[3]=n=>I("anticlockwise"))},{default:p(()=>[o(t(je))]),_:1}),o(t(w),{onClick:a[4]||(a[4]=n=>I("clockwise"))},{default:p(()=>[o(t(Fe))]),_:1})],2)],2),E(" CANVAS "),v("div",{class:d(t(l).e("canvas"))},[(N(!0),L(J,null,Ie(e.urlList,(n,c)=>he((N(),L("img",{ref_for:!0,ref:m=>Y.value[c]=m,key:n,src:n,style:G(t(ie)),class:d(t(l).e("img")),crossorigin:ae.value,onLoad:de,onError:fe,onMousedown:me},null,46,Ze)),[[ke,c===_.value]])),128))],2),xe(e.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var qe=Ve(We,[["__file","image-viewer.vue"]]);const Ge=Se(qe);function Je(f){const k=document.createElement("div"),g=o(Ge,Object.assign({onClose:function(){Q(null,k),typeof f.onClose=="function"&&f.onClose.call(this)}},f));return Q(g,k),document.body.appendChild(k.firstElementChild),g}const Qe={class:"image-viewer"},Ue=V({setup:!0,name:"ImageViewer",getComponents:()=>[ee]}),ot=V({...Ue,__name:"imageViewer",setup(f){const k=()=>Je({urlList:["https://scpic.chinaz.net/Files/pic/pic6/pic1281.jpg","https://scpic.chinaz.net/files/pic/pic9/202009/apic27858.jpg","https://tse3-mm.cn.bing.net/th/id/OIP-C.n0_p3rYRuofABd3XudbZnAHaEo?pid=ImgDet&rs=1"]});return(g,s)=>{const h=ee;return N(),L("div",Qe,[o(h,{onClick:s[0]||(s[0]=X=>k())},{default:p(()=>[ze(" 预览 ")]),_:1})])}}});export{ot as default};
